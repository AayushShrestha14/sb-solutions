<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="2-create-hibernate_sequence" author="msucil">
        <createTable tableName="hibernate_sequence">
            <column name="next_val" type="BIGINT" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="2-populate-hibernate_sequence" author="msucil">
        <insert tableName="hibernate_sequence">
            <column name="next_val" valueNumeric="1"/>
        </insert>
    </changeSet>

    <changeSet id="2-create-oauth-token-table" author="msucil">
        <createTable tableName="oauth_access_token">
            <column name="token_id" type="VARCHAR(256)">
                <constraints nullable="true"/>
            </column>
            <column name="token" type="BLOB">
                <constraints nullable="true"/>
            </column>
            <column name="authentication_id" type="VARCHAR(256)">
                <constraints nullable="true"/>
            </column>
            <column name="user_name" type="VARCHAR(256)">
                <constraints nullable="true"/>
            </column>
            <column name="client_id" type="VARCHAR(256)">
                <constraints nullable="true"/>
            </column>
            <column name="authentication" type="BLOB">
                <constraints nullable="true"/>
            </column>
            <column name="refresh_token" type="VARCHAR(256)">
                <constraints nullable="true"/>
            </column>
        </createTable>

        <addPrimaryKey tableName="oauth_access_token" columnNames="authentication_id"/>

        <createTable tableName="oauth_refresh_token">
            <column name="token_id" type="VARCHAR(256)">
                <constraints nullable="true"/>
            </column>
            <column name="token" type="BLOB">
                <constraints nullable="true"/>
            </column>
            <column name="authentication" type="BLOB">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="4-create-role-table" author="david">
        <createTable tableName="role">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="role_name" type="VARCHAR(256)">
                <constraints nullable=" false"
                             unique="true"
                             uniqueConstraintName="udx_role_role_name"
                />
            </column>
            <column name="status" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="created_by_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_by_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_at" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="INT" defaultValueNumeric="0"/>
        </createTable>
    </changeSet>

    <changeSet id="4-create-branch" author="msucil">
        <createTable tableName="branch">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(256)">
                <constraints nullable=" false"
                             unique="true"
                             uniqueConstraintName="udx_branch_name"
                />
            </column>
            <column name="branch_code" type="VARCHAR(256)"/>
            <column name="address" type="VARCHAR(256)"/>
            <column name="status" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_at" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="INT" defaultValueNumeric="0"/>
        </createTable>
    </changeSet>

    <changeSet id="4-create-user-table" author="msucil">
        <createTable tableName="user">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(256)"/>
            <column name="user_name" type="VARCHAR(256)">
                <constraints nullable=" false"
                             unique="true"
                             uniqueConstraintName="udx_user_username"
                />
            </column>
            <column name="email" type="VARCHAR(256)">
                <constraints nullable=" false"
                             unique="true"
                             uniqueConstraintName="udx_user_email"
                />
            </column>
            <column name="password" type="VARCHAR(256)">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="role_id" type="BIGINT">
                <constraints nullable="true"
                             foreignKeyName="fk_user_role_id"
                             referencedTableName="role"
                             referencedColumnNames="id"
                />
            </column>
            <column name="branch_id" type="BIGINT">
                <constraints nullable="true"
                             foreignKeyName="fk_user_branch_id"
                             referencedTableName="branch"
                             referencedColumnNames="id"/>
            </column>
            <column name="account_no" type="VARCHAR(256)"/>
            <column name="signature_image" type="VARCHAR(256)"/>
            <column name="profile_picture" type="VARCHAR(256)"/>
            <column name="created_at" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_at" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="INT" defaultValueNumeric="0"/>
        </createTable>
    </changeSet>
    <changeSet id="4-create-foreign-key-in-role-table" author="david">
        <addForeignKeyConstraint baseTableName="role" baseColumnNames="created_by_id"
                                 constraintName="fk_role_created_by_id" referencedTableName="user"
                                 referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="role" baseColumnNames="last_modified_by_id"
                                 constraintName="fk_role_last_modified_by_id" referencedTableName="user"
                                 referencedColumnNames="id"/>
    </changeSet>


    <changeSet id="4-create-document" author="msucil">
        <createTable tableName="document">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(256)">
                <constraints nullable=" false"
                             unique="true"
                             uniqueConstraintName="udx_document_name"
                />
            </column>
            <column name="url" type="VARCHAR(256)"/>
            <column name="status" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_at" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="INT" defaultValueNumeric="0"/>
        </createTable>
    </changeSet>

    <changeSet id="4-create-loan-cycle" author="msucil">
        <createTable tableName="loan_cycle">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="cycle" type="VARCHAR(256)">
                <constraints nullable=" false"/>
            </column>
            <column name="url" type="VARCHAR(256)"/>
            <column name="status" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_at" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="INT" defaultValueNumeric="0"/>
        </createTable>
    </changeSet>

    <changeSet id="4-create-base_http" author="david">
        <createTable tableName="base_http">
            <column name="base_http_id" type="BIGINT" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="base_url" type="VARCHAR(256)">
                <constraints nullable=" false"/>
            </column>
            <column name="flag" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="4-create-document-loan-cycle" author="msucil">
        <createTable tableName="document_loan_cycle">
            <column name="document_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="loan_cycle_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseColumnNames="document_id"
                                 baseTableName="document_loan_cycle"
                                 constraintName="fk_document_loan_cycle_document_id"
                                 onDelete="CASCADE"
                                 onUpdate="CASCADE"
                                 referencedColumnNames="id"
                                 referencedTableName="document"/>
        <addForeignKeyConstraint baseColumnNames="loan_cycle_id"
                                 baseTableName="document_loan_cycle"
                                 constraintName="fk_document_loan_cycle_loan_cycle_id"
                                 onDelete="RESTRICT"
                                 onUpdate="CASCADE"
                                 referencedColumnNames="id"
                                 referencedTableName="loan_cycle"/>
    </changeSet>

    <changeSet id="3-create-memo-type-table" author="msucil">
        <createTable tableName="memo_type">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(256)">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="INT">
                <constraints nullable="false"/>
            </column>

            <column name="created_at" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_at" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="INT" defaultValueNumeric="0"/>
        </createTable>
    </changeSet>

    <changeSet id="3-create-memo-table" author="msucil">
        <createTable tableName="memo">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="subject" type="VARCHAR(256)">
                <constraints nullable="false"/>
            </column>
            <column name="referenceNo" type="VARCHAR(256)">
                <constraints nullable="false"/>
            </column>
            <column name="sent_by" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="sent_to" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="content" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="stage" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="memo_type_id" type="BIGINT">
                <constraints nullable="false"
                             foreignKeyName="fk_memo_type_id"
                             referencedTableName="memo_type"
                             referencedColumnNames="id"
                />
            </column>

            <column name="created_at" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_at" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="INT" defaultValueNumeric="0"/>
        </createTable>
    </changeSet>

    <changeSet id="3-create-memo-cc-user-table" author="msucil">
        <createTable tableName="memo_cc_user">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="memo_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint baseTableName="memo_cc_user" baseColumnNames="user_id"
                                 constraintName="fk_memo_cc_user_user_id"
                                 referencedTableName="user" referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="memo_cc_user" baseColumnNames="memo_id"
                                 constraintName="fk_memo_cc_user_memo_id"
                                 referencedTableName="memo" referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="3-create-memo-bcc-user-table" author="msucil">
        <createTable tableName="memo_bcc_user">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="memo_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseTableName="memo_bcc_user" baseColumnNames="user_id"
                                 constraintName="fk_memo_bcc_user_user_id"
                                 referencedTableName="user" referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="memo_bcc_user" baseColumnNames="memo_id"
                                 constraintName="fk_memo_bcc_user_memo_id"
                                 referencedTableName="memo" referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="3-create-memo-stage-table" author="msucil">
        <createTable tableName="memo_stage">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="memo_id" type="BIGINT">
                <constraints nullable="false"
                             foreignKeyName="fk_memo_stage_memo_id"
                             referencedColumnNames="id"
                             referencedTableName="memo"
                />
            </column>
            <column name="sent_by" type="BIGINT">
                <constraints nullable="false"
                             foreignKeyName="fk_memo_stage_sent_by_user_id"
                             referencedColumnNames="id"
                             referencedTableName="user"
                />
            </column>
            <column name="sent_to" type="BIGINT">
                <constraints nullable="false"
                             foreignKeyName="fk_memo_stage_sent_to_user_id"
                             referencedTableName="user"
                             referencedColumnNames="id"/>
            </column>
            <column name="stage" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="note" type="TEXT"/>

            <column name="created_at" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_at" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="INT" defaultValueNumeric="0"/>
        </createTable>
    </changeSet>
</databaseChangeLog>